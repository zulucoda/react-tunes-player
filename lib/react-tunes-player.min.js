"use strict";var e=require("react"),t=require("prop-types"),n=require("styled-components");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=r(e),l=r(n);function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,l=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(l.push(r.value),!t||l.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d,m,c,s,f,v,g,p,E,w,h,b,x,y,L,z,T,k,C,M,S,N,B,j={mobileS:0,mobileM:375,mobileL:425,tablet:768,laptop:1024,laptopL:1440,desktop:2560},P=Object.keys(j).reduce((function(e,t){return e[t]="(min-width: ".concat(j[t],"px)"),e}),{}),F=l.default.div(d||(d=i(["\n  font-family: sans-serif;\n  font-size: 1em;\n  position: fixed;\n  bottom: -5px;\n  visibility: hidden;\n  width: 100%;\n  -webkit-perspective: 900;\n  perspective: 900;\n  -webkit-perspective-origin: 80% 100%;\n  perspective-origin: 80% 100%;\n"]))),O=l.default.div(m||(m=i(["\n  box-shadow: 0 0 6px 1px rgba(0, 0, 0, 0.25);\n  height: 75px;\n  visibility: visible;\n  transition: -webkit-transform 200ms ease-out;\n  transition: transform 200ms ease-out;\n  -webkit-transform: translateY(100%);\n  transform: translateY(100%);\n\n  background-color: #f2f2f2;\n  border-top: 1px solid #cecece;\n\n  -webkit-transform: translateY(0);\n  transform: translateY(0);\n"]))),V=l.default.div(c||(c=i(["\n  padding-bottom: 10px;\n  visibility: visible;\n  position: relative;\n  height: 100%;\n"]))),H=l.default.div(s||(s=i(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  width: 100%;\n"]))),I=l.default.div(f||(f=i(["\n  margin: 0 1em 0 0;\n  img {\n    display: none;\n\n    @media "," {\n      display: inline;\n      height: 75px;\n    }\n  }\n"])),P.mobileL),q=l.default.div(v||(v=i(["\n  margin: 2em 0 0 0;\n  font-size: 0.8em;\n  flex-grow: 1;\n  flex-basis: 9.3em;\n\n  @media "," {\n    flex-grow: 1;\n  }\n\n  @media "," {\n    font-size: 1em;\n    margin: 1.7em 1em 0 0;\n  }\n\n  @media "," {\n    font-size: 1em;\n    margin: 2em 1em 0 0;\n  }\n"])),P.mobileL,P.tablet,P.laptop),A=l.default.div(g||(g=i(["\n  margin: 1.5em 0 0 0;\n  flex-grow: 1;\n\n  @media "," {\n    margin: 1.7em 0 0 0;\n  }\n"])),P.tablet),D=l.default.a(p||(p=i(["\n  background-color: transparent;\n  color: #231f20;\n  font-size: 1em;\n  padding: 1em 0.5em 0 0.5em;\n\n  @media "," {\n    font-size: 1em;\n    padding: 0 0.7em 0 0.7em;\n  }\n\n  @media "," {\n    font-size: 1.5em;\n    padding: 0 1em 0 1em;\n  }\n\n  > svg {\n    cursor: pointer;\n    fill: #594c4f;\n    width: 0.7em;\n    height: 0.7em;\n\n    @media "," {\n      width: 0.8em;\n      height: 0.8em;\n    }\n\n    @media "," {\n      width: 0.8em;\n      height: 0.8em;\n    }\n\n    &:hover {\n      fill: #e93733;\n    }\n  }\n"])),P.tablet,P.laptop,P.tablet,P.laptop),R=l.default(D)(E||(E=i([""]))),Y=l.default(D)(w||(w=i([""]))),W=l.default(D)(h||(h=i(["\n  > svg {\n    fill: ",";\n  }\n"])),(function(e){return e.isPlaying?"#E93733":"#594C4F"})),U=l.default(D)(b||(b=i(["\n  > svg {\n    fill: ",";\n  }\n"])),(function(e){return e.isPlaying?"#594C4F":"#E93733"})),X=l.default.div(x||(x=i(["\n  display: none;\n  @media "," {\n    display: inline;\n    margin: 1.7em 0 0 0;\n    flex-grow: 2;\n  }\n\n  @media "," {\n    display: inline;\n    margin: 2em 0 0 0;\n    flex-grow: 2;\n  }\n  > progress {\n    width: 100%;\n\n    /* Turns off styling - not usually needed, but good to know. */\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n\n    color: #e93733; /* IE 10 */\n\n    /* Needs to be in here for Safari polyfill so background images work as expected. */\n    background-size: auto;\n\n    &::-moz-progress-bar {\n      background-color: #e93733;\n    }\n\n    &::-webkit-progress-value {\n      background-color: #e93733;\n    }\n  }\n"])),P.tablet,P.laptop),$=l.default.div(y||(y=i(["\n  margin: 2em 1em 0 1em;\n  font-size: 0.8em;\n  flex-basis: 5.5em;\n  text-align: center;\n\n  @media "," {\n    font-size: 1em;\n    margin: 1.7em 1em 0 1em;\n  }\n\n  @media "," {\n    font-size: 1em;\n    margin: 2em 1em 0 1em;\n  }\n"])),P.tablet,P.laptop),G=l.default(A)(L||(L=i(["\n  display: none;\n  @media "," {\n    display: inline;\n  }\n"])),P.laptop),J=l.default(D)(z||(z=i(["\n  > svg {\n    fill: ",";\n  }\n"])),(function(e){return 1===e.volume?"#E93733":"#594C4F"})),K=l.default(D)(T||(T=i(["\n  > svg {\n    fill: ",";\n  }\n"])),(function(e){return.5===e.volume?"#E93733":"#594C4F"})),Q=l.default(D)(k||(k=i(["\n  > svg {\n    fill: ",";\n  }\n"])),(function(e){return.3===e.volume?"#E93733":"#594C4F"})),Z=l.default(D)(C||(C=i(["\n  > svg {\n    fill: ",";\n  }\n"])),(function(e){return 0===e.volume?"#E93733":"#594C4F"})),_=l.default.div(M||(M=i(["\n  margin: 0 auto;\n  display: none;\n"]))),ee=l.default.div(S||(S=i(["\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n\n  > svg {\n    width: 3em;\n    height: 3em;\n    fill: #e93733;\n  }\n"]))),te=l.default.div(N||(N=i(["\n  display: flex;\n  flex-direction: row;\n  justify-content: start;\n  align-items: center;\n  flex-grow: 2;\n  > svg {\n    fill: #e93733;\n  }\n"]))),ne=l.default.span(B||(B=i(["\n  padding: 0.5em 0 0 0;\n  font-size: 1em;\n  vertical-align: center;\n  p {\n    padding: 0;\n    margin: 0;\n  }\n"]))),re=function(){return a.default.createElement(ee,null,a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M32 464h448L256 48 32 464zm248-64h-48v-48h48v48zm0-80h-48v-96h48v96z"})),a.default.createElement(ne,null,"Warning! No tunes loaded in player."))},ae=function(e,t){return e&&e.length?e.findIndex((function(e){return e.name===t.name})):-1},le=function(e,t,n){var r=ae(e,t)-1;n(r<=-1?e[e.length-1]:e[r])},ie=function(t){var n=t.currentTune,r=t.isPlaying,l=t.volume,i=t.onEnded,u=t.setTuneDuration,o=t.setSeekTimeTune,d=t.seekTimeTune,m=t.triggerCurrentTime,c=t.setTriggerCurrentTime,s=t.setIsLoading,f=t.setOnError,v=e.useRef(),g=function(e){u(Number.isNaN(e.target.duration)?0:e.target.duration),o(e.target.currentTime)},p=function(){s(!1)},E=function(){s(!1),f(!0)},w=function(){s(!1),f(!0)};return e.useEffect((function(){return v.current.addEventListener("timeupdate",g),r?v.current.play():v.current.pause(),v.current.volume=l,v.current.currentTime=d,c(!1),function(){v.current.removeEventListener("timeupdate",g)}}),[n,r,l,m]),e.useEffect((function(){return v.current.addEventListener("ended",i),v.current.addEventListener("loadeddata",p),v.current.addEventListener("stalled",E),v.current.addEventListener("error",w),function(){v.current.removeEventListener("ended",i),v.current.removeEventListener("loadeddata",p),v.current.removeEventListener("stalled",E),v.current.removeEventListener("error",w)}}),[n]),a.default.createElement("audio",{controls:!0,ref:v,src:n.tune,"data-testid":"current-tune-audio"})},ue=function(t){var n=t.tuneDuration,r=t.seekTimeTune,l=t.setSeekTimeTune,i=t.setTriggerCurrentTime,u=t.setDrag,o=t.drag,d=e.useRef(null),m=function(e){var t=(e.pageX-e.target.offsetLeft)*e.target.max/e.target.offsetWidth;l(t),i(!0)},c=function(){return u(!1)},s=function(){return u(!0)},f=function(e){return o?m(e):"clicked"};return e.useEffect((function(){return d.current.addEventListener("click",m),d.current.addEventListener("mousedown",c),d.current.addEventListener("mousemove",s),d.current.addEventListener("mouseup",f),function(){d.current.removeEventListener("click",m),d.current.removeEventListener("mousedown",c),d.current.removeEventListener("mousemove",s),d.current.removeEventListener("mouseup",f)}}),[n,o]),a.default.createElement("progress",{ref:d,max:n,value:r,"data-testid":"current-tune-progress-bar"})},oe=function(e){var t=e.currentTune;return a.default.createElement(ee,null,a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M32 464h448L256 48 32 464zm248-64h-48v-48h48v48zm0-80h-48v-96h48v96z"})),a.default.createElement(ne,null,a.default.createElement("p",null,"Warning! Error while trying to load tune"," ",a.default.createElement("strong",null,t.name),"."),a.default.createElement("p",null,"Is the tune source ",a.default.createElement("strong",null,t.tune)," correct?")))},de=function(){return a.default.createElement(te,null,a.default.createElement("svg",{width:"120",height:"30",viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:"#e93733"},a.default.createElement("circle",{cx:"15",cy:"15",r:"15"},a.default.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),a.default.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),a.default.createElement("circle",{cx:"60",cy:"15",r:"9","fill-opacity":"0.3"},a.default.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),a.default.createElement("animate",{attributeName:"fill-opacity",from:"0.5",to:"0.5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),a.default.createElement("circle",{cx:"105",cy:"15",r:"15"},a.default.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),a.default.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"}))))},me=function(t){var n=t.tunes,r=void 0===n?[]:n,l=u(e.useState(null),2),i=l[0],o=l[1],d=u(e.useState(!1),2),m=d[0],c=d[1],s=u(e.useState(1),2),f=s[0],v=s[1],g=u(e.useState(0),2),p=g[0],E=g[1],w=u(e.useState(0),2),h=w[0],b=w[1],x=u(e.useState(!1),2),y=x[0],L=x[1],z=u(e.useState(!1),2),T=z[0],k=z[1],C=u(e.useState(!0),2),M=C[0],S=C[1],N=u(e.useState(!1),2),B=N[0],j=N[1];e.useEffect((function(){r.length>0&&o(r[0])}),[r]);var P=function(){E(0),b(0)};return 0===r.length?a.default.createElement(F,null,a.default.createElement(O,null,a.default.createElement(re,null))):i?B?a.default.createElement(F,null,a.default.createElement(O,null,a.default.createElement(oe,{currentTune:i}))):a.default.createElement(F,null,a.default.createElement(O,null,a.default.createElement(V,null,a.default.createElement(H,null,a.default.createElement(I,null,a.default.createElement("img",{"data-testid":"current-tune-album-art",alt:i.name,src:i.album})),a.default.createElement(q,null,a.default.createElement("span",{"data-testid":"current-tune-name"},i.name)),M?a.default.createElement(de,null):a.default.createElement(e.Fragment,null,a.default.createElement(A,null,a.default.createElement(R,{title:"Previous tune",onClick:function(){S(!0),P(),le(r,i,o)},"data-testid":"previous-tune"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M170.7 256L448 448V64L170.7 256zM64 64h64v384H64z"}))),a.default.createElement(W,{isPlaying:m,title:"Play tune",onClick:function(){return c(!0)},"data-testid":"play-tune"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M96 52v408l320-204L96 52z"}))),a.default.createElement(U,{isPlaying:m,title:"Pause tune",onClick:function(){return c(!1)},"data-testid":"pause-tune"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M96 448h106.7V64H96v384zM309.3 64v384H416V64H309.3z"}))),a.default.createElement(Y,{title:"Next tune",onClick:function(){S(!0),P(),function(e,t,n){var r=ae(e,t)+1;r>=e.length?n(e[0]):n(e[r])}(r,i,o)},"data-testid":"next-tune"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M64 64v384l277.3-192L64 64zM384 64h64v384h-64z"})))),a.default.createElement(X,null,a.default.createElement(ue,{seekTimeTune:p,tuneDuration:h,setSeekTimeTune:E,setTriggerCurrentTime:L,drag:T,setDrag:k})),a.default.createElement($,null,"".concat(p>0?(p/60).toFixed(2):0," / ").concat(h>0?(h/60).toFixed(2):0)),a.default.createElement(G,null,a.default.createElement(J,{volume:f,onClick:function(){return v(1)},"data-testid":"high-volume"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M64 192v128h85.334L256 431.543V80.458L149.334 192H64zm288 64c0-38.399-21.333-72.407-53.333-88.863v176.636C330.667 328.408 352 294.4 352 256zM298.667 64v44.978C360.531 127.632 405.334 186.882 405.334 256c0 69.119-44.803 128.369-106.667 147.022V448C384 428.254 448 349.257 448 256c0-93.256-64-172.254-149.333-192z"}))),a.default.createElement(K,{volume:f,onClick:function(){return v(.5)},"data-testid":"medium-volume"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M64 192v128h85.334L256 431.543V80.458L149.334 192H64zm288 64c0-38.399-21.333-72.407-53.333-88.863v176.636C330.667 328.408 352 294.4 352 256z"}))),a.default.createElement(Q,{volume:f,onClick:function(){return v(.3)},"data-testid":"low-volume"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M64 192v128h85.334L256 431.543V80.458L149.334 192H64z"}))),a.default.createElement(Z,{volume:f,onClick:function(){return v(0)},"data-testid":"mute-volume"},a.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.default.createElement("path",{d:"M405.5 256c0 22.717-4.883 44.362-13.603 63.855l31.88 31.88C439.283 323.33 448 290.653 448 256c0-93.256-64-172.254-149-192v44.978C361 127.632 405.5 186.882 405.5 256zM256 80.458l-51.021 52.48L256 183.957zM420.842 396.885L91.116 67.157l-24 24 90.499 90.413-8.28 10.43H64v128h85.334L256 431.543V280l94.915 94.686C335.795 387.443 318 397.213 299 403.022V448c31-7.172 58.996-22.163 82.315-42.809l39.61 39.693 24-24.043-24.002-24.039-.081.083z"}),a.default.createElement("path",{d:"M352.188 256c0-38.399-21.188-72.407-53.188-88.863v59.82l50.801 50.801A100.596 100.596 0 0 0 352.188 256z"}))))),a.default.createElement(_,null,a.default.createElement(ie,{currentTune:i,isPlaying:m,volume:f,onEnded:function(){S(!0),P(),le(r,i,o)},setTuneDuration:b,setSeekTimeTune:E,seekTimeTune:p,triggerCurrentTime:y,setTriggerCurrentTime:L,setIsLoading:S,setOnError:j})))))):null};me.propTypes={tunes:t.arrayOf(t.exact({tune:t.string.isRequired,name:t.string.isRequired,album:t.string.isRequired})).isRequired},module.exports=me;
