'use strict';
function _interopDefault(e) {
  return e && 'object' == typeof e && 'default' in e ? e.default : e;
}
var React = require('react'),
  React__default = _interopDefault(React),
  propTypes = require('prop-types'),
  styled = _interopDefault(require('styled-components'));
function _taggedTemplateLiteral(e, t) {
  return (
    (t = t || e.slice(0)),
    Object.freeze(
      Object.defineProperties(e, { raw: { value: Object.freeze(t) } }),
    )
  );
}
function _slicedToArray(e, t) {
  return (
    _arrayWithHoles(e) || _iterableToArrayLimit(e, t) || _nonIterableRest()
  );
}
function _arrayWithHoles(e) {
  if (Array.isArray(e)) return e;
}
function _iterableToArrayLimit(e, t) {
  var n = [],
    r = !0,
    a = !1,
    l = void 0;
  try {
    for (
      var i, u = e[Symbol.iterator]();
      !(r = (i = u.next()).done) && (n.push(i.value), !t || n.length !== t);
      r = !0
    );
  } catch (e) {
    (a = !0), (l = e);
  } finally {
    try {
      r || null == u.return || u.return();
    } finally {
      if (a) throw l;
    }
  }
  return n;
}
function _nonIterableRest() {
  throw new TypeError('Invalid attempt to destructure non-iterable instance');
}
var HIGH_VOLUME = 1,
  MEDIUM_VOLUME = 0.5,
  LOW_VOLUME = 0.3,
  MUTE_VOLUME = 0,
  size = {
    mobileS: 0,
    mobileM: 375,
    mobileL: 425,
    tablet: 768,
    laptop: 1024,
    laptopL: 1440,
    desktop: 2560,
  },
  device = Object.keys(size).reduce(function(e, t) {
    return (e[t] = '(min-width: '.concat(size[t], 'px)')), e;
  }, {});
function _templateObject22() {
  var e = _taggedTemplateLiteral([
    '\n  padding: 0.5rem 0 0 0;\n  font-size: 2rem;\n  vertical-align: center;\n',
  ]);
  return (
    (_templateObject22 = function() {
      return e;
    }),
    e
  );
}
function _templateObject21() {
  var e = _taggedTemplateLiteral([
    '\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n\n  > svg {\n    width: 3rem;\n    height: 3rem;\n    fill: #e93733;\n  }\n',
  ]);
  return (
    (_templateObject21 = function() {
      return e;
    }),
    e
  );
}
function _templateObject20() {
  var e = _taggedTemplateLiteral(['\n  margin: 0 auto;\n  display: none;\n']);
  return (
    (_templateObject20 = function() {
      return e;
    }),
    e
  );
}
function _templateObject19() {
  var e = _taggedTemplateLiteral(['\n  > svg {\n    fill: ', ';\n  }\n']);
  return (
    (_templateObject19 = function() {
      return e;
    }),
    e
  );
}
function _templateObject18() {
  var e = _taggedTemplateLiteral(['\n  > svg {\n    fill: ', ';\n  }\n']);
  return (
    (_templateObject18 = function() {
      return e;
    }),
    e
  );
}
function _templateObject17() {
  var e = _taggedTemplateLiteral(['\n  > svg {\n    fill: ', ';\n  }\n']);
  return (
    (_templateObject17 = function() {
      return e;
    }),
    e
  );
}
function _templateObject16() {
  var e = _taggedTemplateLiteral(['\n  > svg {\n    fill: ', ';\n  }\n']);
  return (
    (_templateObject16 = function() {
      return e;
    }),
    e
  );
}
function _templateObject15() {
  var e = _taggedTemplateLiteral([
    '\n  @media ',
    ' {\n    display: none;\n  }\n\n  @media ',
    ' {\n    display: inline;\n  }\n',
  ]);
  return (
    (_templateObject15 = function() {
      return e;
    }),
    e
  );
}
function _templateObject14() {
  var e = _taggedTemplateLiteral([
    '\n  margin: 2rem 0 0 1rem;\n  @media ',
    ' {\n    margin: 2rem 1rem 0 1rem;\n    font-size: 0.7rem;\n  }\n\n  @media ',
    ' {\n    font-size: 1rem;\n  }\n',
  ]);
  return (
    (_templateObject14 = function() {
      return e;
    }),
    e
  );
}
function _templateObject13() {
  var e = _taggedTemplateLiteral([
    '\n  margin: 2rem 0 0 0;\n  flex-grow: 2;\n\n  @media ',
    ' {\n    display: none;\n  }\n\n  @media ',
    ' {\n    display: inline;\n  }\n\n  > progress {\n    width: 100%;\n\n    /* Turns off styling - not usually needed, but good to know. */\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n\n    color: #e93733; /* IE 10 */\n\n    /* Needs to be in here for Safari polyfill so background images work as expected. */\n    background-size: auto;\n\n    &::-moz-progress-bar {\n      background-color: #e93733;\n    }\n\n    &::-webkit-progress-value {\n      background-color: #e93733;\n    }\n  }\n',
  ]);
  return (
    (_templateObject13 = function() {
      return e;
    }),
    e
  );
}
function _templateObject12() {
  var e = _taggedTemplateLiteral(['\n  > svg {\n    fill: ', ';\n  }\n']);
  return (
    (_templateObject12 = function() {
      return e;
    }),
    e
  );
}
function _templateObject11() {
  var e = _taggedTemplateLiteral(['\n  > svg {\n    fill: ', ';\n  }\n']);
  return (
    (_templateObject11 = function() {
      return e;
    }),
    e
  );
}
function _templateObject10() {
  var e = _taggedTemplateLiteral(['']);
  return (
    (_templateObject10 = function() {
      return e;
    }),
    e
  );
}
function _templateObject9() {
  var e = _taggedTemplateLiteral(['']);
  return (
    (_templateObject9 = function() {
      return e;
    }),
    e
  );
}
function _templateObject8() {
  var e = _taggedTemplateLiteral([
    '\n  background-color: transparent;\n  color: #231f20;\n  font-size: 2em;\n  padding: 0 1rem 0 1rem;\n\n  @media ',
    ' {\n    font-size: 0.7rem;\n    padding: 1rem 0.5rem 0 0.5rem;\n  }\n\n  @media ',
    ' {\n    font-size: 1.3em;\n    padding: 0 1rem 0 1rem;\n  }\n\n  @media ',
    ' {\n    font-size: 2em;\n  }\n\n  > svg {\n    width: 1rem;\n    height: 1rem;\n    cursor: pointer;\n    fill: #594c4f;\n\n    @media ',
    ' {\n      width: 0.7rem;\n      height: 0.7rem;\n    }\n\n    @media ',
    ' {\n      width: 0.8rem;\n      height: 0.8rem;\n    }\n\n    @media ',
    ' {\n      width: 1rem;\n      height: 1rem;\n    }\n\n    &:hover {\n      fill: #e93733;\n    }\n  }\n',
  ]);
  return (
    (_templateObject8 = function() {
      return e;
    }),
    e
  );
}
function _templateObject7() {
  var e = _taggedTemplateLiteral([
    '\n  margin: 1.2rem 0 0 0;\n\n  @media ',
    ' {\n    margin: 1.8rem 0 0 0;\n  }\n\n  @media ',
    ' {\n    margin: 1.2rem 0 0 0;\n  }\n',
  ]);
  return (
    (_templateObject7 = function() {
      return e;
    }),
    e
  );
}
function _templateObject6() {
  var e = _taggedTemplateLiteral([
    '\n  margin: 2rem 1rem 0 0;\n  @media ',
    ' {\n    margin: 2rem 0 0 0;\n    font-size: 0.7rem;\n    flex-grow: 2;\n  }\n\n  @media ',
    ' {\n    display: inline;\n    flex-grow: 1;\n  }\n\n  @media ',
    ' {\n    display: inline;\n    font-size: 1rem;\n    margin: 2rem 1rem 0 0;\n  }\n',
  ]);
  return (
    (_templateObject6 = function() {
      return e;
    }),
    e
  );
}
function _templateObject5() {
  var e = _taggedTemplateLiteral([
    '\n  margin: 0 1rem 0 0;\n  img {\n    height: 75px;\n    @media ',
    ' {\n      display: none;\n    }\n\n    @media ',
    ' {\n      display: inline;\n    }\n  }\n',
  ]);
  return (
    (_templateObject5 = function() {
      return e;
    }),
    e
  );
}
function _templateObject4() {
  var e = _taggedTemplateLiteral([
    '\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  width: 100%;\n',
  ]);
  return (
    (_templateObject4 = function() {
      return e;
    }),
    e
  );
}
function _templateObject3() {
  var e = _taggedTemplateLiteral([
    '\n  padding-bottom: 10px;\n  visibility: visible;\n  position: relative;\n  height: 100%;\n',
  ]);
  return (
    (_templateObject3 = function() {
      return e;
    }),
    e
  );
}
function _templateObject2() {
  var e = _taggedTemplateLiteral([
    '\n  box-shadow: 0 0 6px 1px rgba(0, 0, 0, 0.25);\n  height: 75px;\n  visibility: visible;\n  transition: -webkit-transform 200ms ease-out;\n  transition: transform 200ms ease-out;\n  -webkit-transform: translateY(100%);\n  transform: translateY(100%);\n\n  background-color: #f2f2f2;\n  border-top: 1px solid #cecece;\n\n  -webkit-transform: translateY(0);\n  transform: translateY(0);\n',
  ]);
  return (
    (_templateObject2 = function() {
      return e;
    }),
    e
  );
}
function _templateObject() {
  var e = _taggedTemplateLiteral([
    '\n  position: fixed;\n  bottom: -5px;\n  visibility: hidden;\n  width: 100%;\n  -webkit-perspective: 900;\n  perspective: 900;\n  -webkit-perspective-origin: 80% 100%;\n  perspective-origin: 80% 100%;\n',
  ]);
  return (
    (_templateObject = function() {
      return e;
    }),
    e
  );
}
var ReactTunePlayerContainer = styled.div(_templateObject()),
  TunesInner = styled.div(_templateObject2()),
  TunesWrapper = styled.div(_templateObject3()),
  MainWrapper = styled.div(_templateObject4()),
  CurrentAlbumPlaying = styled.div(
    _templateObject5(),
    device.mobileS,
    device.mobileL,
  ),
  NowPlaying = styled.div(
    _templateObject6(),
    device.mobileS,
    device.mobileL,
    device.tablet,
  ),
  Controls = styled.div(_templateObject7(), device.mobileS, device.laptop),
  Btn = styled.a(
    _templateObject8(),
    device.mobileS,
    device.tablet,
    device.laptop,
    device.mobileS,
    device.tablet,
    device.laptop,
  ),
  PreviousTune = styled(Btn)(_templateObject9()),
  NextTune = styled(Btn)(_templateObject10()),
  PlayTune = styled(Btn)(_templateObject11(), function(e) {
    return e.isPlaying ? '#E93733' : '#594C4F';
  }),
  PauseTune = styled(Btn)(_templateObject12(), function(e) {
    return e.isPlaying ? '#594C4F' : '#E93733';
  }),
  SeekTune = styled.div(_templateObject13(), device.mobileS, device.mobileL),
  SeekTime = styled.div(_templateObject14(), device.mobileS, device.tablet),
  Volume = styled(Controls)(_templateObject15(), device.mobileS, device.laptop),
  HighVolume = styled(Btn)(_templateObject16(), function(e) {
    return e.volume === HIGH_VOLUME ? '#E93733' : '#594C4F';
  }),
  MediumVolume = styled(Btn)(_templateObject17(), function(e) {
    return e.volume === MEDIUM_VOLUME ? '#E93733' : '#594C4F';
  }),
  LowVolume = styled(Btn)(_templateObject18(), function(e) {
    return e.volume === LOW_VOLUME ? '#E93733' : '#594C4F';
  }),
  MuteVolume = styled(Btn)(_templateObject19(), function(e) {
    return e.volume === MUTE_VOLUME ? '#E93733' : '#594C4F';
  }),
  AudioWrapper = styled.div(_templateObject20()),
  WarningWrapper = styled.div(_templateObject21()),
  WarningText = styled.span(_templateObject22()),
  NoTunes = function(e) {
    var t = e.errorMsg,
      n = void 0 === t ? 'Warning! No tunes loaded in player.' : t;
    return React__default.createElement(
      WarningWrapper,
      null,
      React__default.createElement(
        'svg',
        { xmlns: 'http://www.w3.org/2000/svg', viewBox: '0 0 512 512' },
        React__default.createElement('path', {
          d:
            'M32 464h448L256 48 32 464zm248-64h-48v-48h48v48zm0-80h-48v-96h48v96z',
        }),
      ),
      React__default.createElement(WarningText, null, n),
    );
  };
NoTunes.propTypes = { errorMsg: propTypes.string };
var findIndex = function(e, t) {
    return e && e.length
      ? e.findIndex(function(e) {
          return e.name === t.name;
        })
      : -1;
  },
  setPreviousTune = function(e, t, n) {
    var r = findIndex(e, t) - 1;
    n(r <= -1 ? e[e.length - 1] : e[r]);
  },
  setNextTune = function(e, t, n) {
    var r = findIndex(e, t) + 1;
    r >= e.length ? n(e[0]) : n(e[r]);
  },
  Audio = function(e) {
    function t(e) {
      i(Number.isNaN(e.target.duration) ? 0 : e.target.duration),
        u(e.target.currentTime);
    }
    var n = e.currentTune,
      r = e.isPlaying,
      a = e.volume,
      l = e.onEnded,
      i = e.setTuneDuration,
      u = e.setSeekTimeTune,
      c = e.seekTimeTune,
      o = e.triggerCurrentTime,
      m = e.setTriggerCurrentTime,
      d = React.useRef();
    return (
      React.useEffect(
        function() {
          return (
            d.current.addEventListener('ended', l),
            d.current.addEventListener('timeupdate', t),
            r ? d.current.play() : d.current.pause(),
            (d.current.volume = a),
            (d.current.currentTime = c),
            m(!1),
            function() {
              d.current.removeEventListener('ended', l),
                d.current.removeEventListener('timeupdate', t);
            }
          );
        },
        [n, r, a, o],
      ),
      React__default.createElement('audio', {
        controls: !0,
        ref: d,
        src: n.tune,
      })
    );
  },
  Progress = function(e) {
    function t(e) {
      var t =
        ((e.pageX - e.target.offsetLeft) * e.target.max) / e.target.offsetWidth;
      u(t), c(!0);
    }
    function n() {
      return o(!1);
    }
    function r() {
      return o(!0);
    }
    function a(e) {
      return m ? t(e) : 'clicked';
    }
    var l = e.tuneDuration,
      i = e.seekTimeTune,
      u = e.setSeekTimeTune,
      c = e.setTriggerCurrentTime,
      o = e.setDrag,
      m = e.drag,
      d = React.useRef(null);
    return (
      React.useEffect(
        function() {
          return (
            d.current.addEventListener('click', t),
            d.current.addEventListener('mousedown', n),
            d.current.addEventListener('mousemove', r),
            d.current.addEventListener('mouseup', a),
            function() {
              d.current.removeEventListener('click', t),
                d.current.removeEventListener('mousedown', n),
                d.current.removeEventListener('mousemove', r),
                d.current.removeEventListener('mouseup', a);
            }
          );
        },
        [l, m],
      ),
      React__default.createElement('progress', { ref: d, max: l, value: i })
    );
  },
  Player = function(e) {
    var t = e.tunes,
      n = _slicedToArray(React.useState(null), 2),
      r = n[0],
      a = n[1],
      l = _slicedToArray(React.useState(!1), 2),
      i = l[0],
      u = l[1],
      c = _slicedToArray(React.useState(HIGH_VOLUME), 2),
      o = c[0],
      m = c[1],
      d = _slicedToArray(React.useState(0), 2),
      s = d[0],
      p = d[1],
      _ = _slicedToArray(React.useState(0), 2),
      f = _[0],
      g = _[1],
      v = _slicedToArray(React.useState(!1), 2),
      b = v[0],
      T = v[1],
      E = _slicedToArray(React.useState(!1), 2),
      y = E[0],
      O = E[1];
    React.useEffect(
      function() {
        a(t[0]);
      },
      [t],
    );
    function w() {
      p(0), g(0);
    }
    return !t && t.length
      ? React__default.createElement(NoTunes, null)
      : r
      ? React__default.createElement(
          ReactTunePlayerContainer,
          null,
          React__default.createElement(
            TunesInner,
            null,
            React__default.createElement(
              TunesWrapper,
              null,
              React__default.createElement(
                MainWrapper,
                null,
                React__default.createElement(
                  CurrentAlbumPlaying,
                  null,
                  React__default.createElement('img', {
                    alt: r.name,
                    src: r.album,
                  }),
                ),
                React__default.createElement(
                  NowPlaying,
                  null,
                  React__default.createElement('span', null, r.name),
                ),
                React__default.createElement(
                  Controls,
                  null,
                  React__default.createElement(
                    PreviousTune,
                    {
                      title: 'Previous tune',
                      onClick: function() {
                        w(), setPreviousTune(t, r, a);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d: 'M170.7 256L448 448V64L170.7 256zM64 64h64v384H64z',
                      }),
                    ),
                  ),
                  React__default.createElement(
                    PlayTune,
                    {
                      isPlaying: i,
                      title: 'Play tune',
                      onClick: function() {
                        return u(!0);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d: 'M96 52v408l320-204L96 52z',
                      }),
                    ),
                  ),
                  React__default.createElement(
                    PauseTune,
                    {
                      isPlaying: i,
                      title: 'Pause tune',
                      onClick: function() {
                        return u(!1);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d:
                          'M96 448h106.7V64H96v384zM309.3 64v384H416V64H309.3z',
                      }),
                    ),
                  ),
                  React__default.createElement(
                    NextTune,
                    {
                      title: 'Next tune',
                      onClick: function() {
                        w(), setNextTune(t, r, a);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d: 'M64 64v384l277.3-192L64 64zM384 64h64v384h-64z',
                      }),
                    ),
                  ),
                ),
                React__default.createElement(
                  SeekTune,
                  null,
                  React__default.createElement(Progress, {
                    seekTimeTune: s,
                    tuneDuration: f,
                    setSeekTimeTune: p,
                    setTriggerCurrentTime: T,
                    drag: y,
                    setDrag: O,
                  }),
                ),
                React__default.createElement(
                  SeekTime,
                  null,
                  ''
                    .concat(0 < s ? (s / 60).toFixed(2) : 0, ' / ')
                    .concat(0 < f ? (f / 60).toFixed(2) : 0),
                ),
                React__default.createElement(
                  Volume,
                  null,
                  React__default.createElement(
                    HighVolume,
                    {
                      onClick: function() {
                        return m(HIGH_VOLUME);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d:
                          'M64 192v128h85.334L256 431.543V80.458L149.334 192H64zm288 64c0-38.399-21.333-72.407-53.333-88.863v176.636C330.667 328.408 352 294.4 352 256zM298.667 64v44.978C360.531 127.632 405.334 186.882 405.334 256c0 69.119-44.803 128.369-106.667 147.022V448C384 428.254 448 349.257 448 256c0-93.256-64-172.254-149.333-192z',
                      }),
                    ),
                  ),
                  React__default.createElement(
                    MediumVolume,
                    {
                      onClick: function() {
                        return m(MEDIUM_VOLUME);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d:
                          'M64 192v128h85.334L256 431.543V80.458L149.334 192H64zm288 64c0-38.399-21.333-72.407-53.333-88.863v176.636C330.667 328.408 352 294.4 352 256z',
                      }),
                    ),
                  ),
                  React__default.createElement(
                    LowVolume,
                    {
                      onClick: function() {
                        return m(LOW_VOLUME);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d:
                          'M64 192v128h85.334L256 431.543V80.458L149.334 192H64z',
                      }),
                    ),
                  ),
                  React__default.createElement(
                    MuteVolume,
                    {
                      onClick: function() {
                        return m(MUTE_VOLUME);
                      },
                    },
                    React__default.createElement(
                      'svg',
                      {
                        xmlns: 'http://www.w3.org/2000/svg',
                        viewBox: '0 0 512 512',
                      },
                      React__default.createElement('path', {
                        d:
                          'M405.5 256c0 22.717-4.883 44.362-13.603 63.855l31.88 31.88C439.283 323.33 448 290.653 448 256c0-93.256-64-172.254-149-192v44.978C361 127.632 405.5 186.882 405.5 256zM256 80.458l-51.021 52.48L256 183.957zM420.842 396.885L91.116 67.157l-24 24 90.499 90.413-8.28 10.43H64v128h85.334L256 431.543V280l94.915 94.686C335.795 387.443 318 397.213 299 403.022V448c31-7.172 58.996-22.163 82.315-42.809l39.61 39.693 24-24.043-24.002-24.039-.081.083z',
                      }),
                      React__default.createElement('path', {
                        d:
                          'M352.188 256c0-38.399-21.188-72.407-53.188-88.863v59.82l50.801 50.801A100.596 100.596 0 0 0 352.188 256z',
                      }),
                    ),
                  ),
                ),
                React__default.createElement(
                  AudioWrapper,
                  null,
                  React__default.createElement(Audio, {
                    currentTune: r,
                    isPlaying: i,
                    volume: o,
                    onEnded: function() {
                      w(), setPreviousTune(t, r, a);
                    },
                    setTuneDuration: g,
                    setSeekTimeTune: p,
                    seekTimeTune: s,
                    triggerCurrentTime: b,
                    setTriggerCurrentTime: T,
                  }),
                ),
              ),
            ),
          ),
        )
      : React__default.createElement(NoTunes, {
          errorMsg: 'No current tune set :(',
        });
  };
(Player.propTypes = { tunes: propTypes.array.isRequired }),
  (module.exports = Player);
